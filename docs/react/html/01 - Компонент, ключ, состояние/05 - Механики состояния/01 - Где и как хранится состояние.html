<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css'>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js'></script>
    <script>hljs.highlightAll();</script>
    <style>* {
  box-sizing: border-box;
}


html {
  scroll-behavior: smooth;

  text-align: justify;       /* Выравнивание по ширине */
  text-align-last: left;     /* Последняя строка - по левому краю */
  hyphens: auto;             /* Перенос слов (опционально) */
}


body {
  margin: 0;
  padding: 0;
  background-color: #1E1E1E;
}


h1 {
  font-size: 2.5rem;
}


.content {
  max-width: 800px;
  padding: 20px;
  margin: 0 auto;
  background-color: #FFC6A3;
}</style>
</head>
<body>
  <section class="content">
    <h1 id="где-и-как-хранится-состояние">Где и как хранится
    состояние</h1>
    <p>Каждый компонент, который мы пишем, в итоге превращается в
    fiber-узел виртуального дерева интерфейса. Этот fiber-узел является
    обычным объектом, в котором довольно много служебных полей, вроде
    ссылки на родителя компонента, дочерние компоненты, соседей и
    т.д.</p>
    <p>Среди всех этих служебных полей есть поле
    <code>memoizedState</code>. В нем и хранится состояние.</p>
    <p>У компонента может быть несколько независимых состояний,
    поскольку мы можем использовать хук useState много раз. Состояния
    хранятся в виде односвязного списка. Каждый элемент списка хранит
    как минимум три значения:</p>
    <ul>
    <li>Сохраненное значение.</li>
    <li>Функцию для изменения значения.</li>
    <li>Ссылку на следующее значение.</li>
    </ul>
    <p>Это не единственные вещи, которые хранит объект состояния.
    Например, у него есть еще одно поле - под запросы обновления
    состояния, в котором (тоже в виде списка) хранятся запросы на
    обновление этого состояния. Это я к тому, что не надо думать, что в
    объекте состояния только три этих поля. Их там может быть гораздо
    больше, просто я упоминаю в конспекте только те, которые относятся к
    текущей теме, чтобы не зашумлять текст.</p>
    <h1 id="почему-порядок-важен">Почему порядок важен</h1>
    <p>При первом рендере компонента каждый вызов useState добавляет в
    список очередное значение.</p>
    <p>А при повторном рендере каждый вызов useState двигается по
    списку, возвращает очередное значение и перемещает указатель на
    следующее. Таким образом, последовательность вызовов useState важна,
    потому что значения состояния извлекаются одно за другим и это
    единственная логика связи значения с состоянием. Поэтому нельзя
    использовать хук useState в каких-то условиях, циклах и т.д., ведь
    если один из вызовов пропустить, тогда порядок извлечения нарушится
    и мы получим, например, в переменную “вес” значение состояния
    “возраст”.</p>
  </section>
</body>
</html>
